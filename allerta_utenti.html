<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allerta Meteo Basilicata</title>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyD1ABRI99tMtvFbbvjqyjbLImfgNMdRR28",
        authDomain: "bollettinoregionale.firebaseapp.com",
        projectId: "bollettinoregionale",
        storageBucket: "bollettinoregionale.firebasestorage.app",
        messagingSenderId: "765538370497",
        appId: "1:765538370497:web:9c4f569754c0df01cc2540",
        measurementId: "G-0BCQ0VRNXF" // Potrebbe non essere presente
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
    </script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <style>
        /* ... (i tuoi stili CSS) ... */
    </style>
</head>
<body>

    <div class="alert-display">
        <h1>Allerta Meteo Basilicata</h1>

        <label for="comune">Seleziona il tuo Comune:</label>
        <select id="comune">
            <option value="">-- Seleziona un Comune --</option>
            </select>

        <div id="alertResults">
            <h2>Allerta Meteo per <span id="selectedLocation"></span></h2>
            <h3>Oggi - <?php echo date('d/m/Y'); ?></h3>
            <p id="oggiAlert"></p>
            <h3>Domani - <?php echo date('d/m/Y', strtotime('+1 day')); ?></h3>
            <p id="domaniAlert"></p>
        </div>
    </div>

    <script>
        const allerteOggi = {};
        const allerteDomani = {};

        const comuniBaseA1 = ["Montemilone", /* ... */ ];
        const comuniBaseA2 = ["MuroLucano", /* ... */ ];
        const comuniBaseB = ["Abriola", /* ... */ ];
        const comuniBaseC = ["Montemurro", /* ... */ ];
        const comuniBaseD = ["Nemoli", /* ... */ ];
        const comuniBaseE1 = ["NovaSiri", /* ... */ ];
        const comuniBaseE2 = ["Montescaglioso", /* ... */ ];

        function mostraAllerta() {
            const comuneSelezionato = document.getElementById("comune").value;
            const selectedLocationElement = document.getElementById("selectedLocation");
            const oggiAlertElement = document.getElementById("oggiAlert");
            const domaniAlertElement = document.getElementById("domaniAlert");

            let oggiColor = "";
            let domaniColor = "";
            let baseComune = "";

            if (comuniBaseA1.includes(comuneSelezionato)) baseComune = "A1";
            else if (comuniBaseA2.includes(comuneSelezionato)) baseComune = "A2";
            else if (comuniBaseB.includes(comuneSelezionato)) baseComune = "B";
            else if (comuniBaseC.includes(comuneSelezionato)) baseComune = "C";
            else if (comuniBaseD.includes(comuneSelezionato)) baseComune = "D";
            else if (comuniBaseE1.includes(comuneSelezionato)) baseComune = "E1";
            else if (comuniBaseE2.includes(comuneSelezionato)) baseComune = "E2";

            if (comuneSelezionato === "all") {
                selectedLocationElement.textContent = "Tutta la Regione";
                oggiAlertElement.innerHTML = `
                    Base A1: <span class="alert-color ${allerteOggi.A1}"></span> ${getColorText(allerteOggi.A1)}<br>
                    Base A2: <span class="alert-color ${allerteOggi.A2}"></span> ${getColorText(allerteOggi.A2)}<br>
                    Base B: <span class="alert-color ${allerteOggi.B}"></span> ${getColorText(allerteOggi.B)}<br>
                    Base C: <span class="alert-color ${allerteOggi.C}"></span> ${getColorText(allerteOggi.C)}<br>
                    Base D: <span class="alert-color ${allerteOggi.D}"></span> ${getColorText(allerteOggi.D)}<br>
                    Base E1: <span class="alert-color ${allerteOggi.E1}"></span> ${getColorText(allerteOggi.E1)}<br>
                    Base E2: <span class="alert-color ${allerteOggi.E2}"></span> ${getColorText(allerteOggi.E2)}
                `;
                domaniAlertElement.innerHTML = `
                    Base A1: <span class="alert-color ${allerteDomani.A1}"></span> ${getColorText(allerteDomani.A1)}<br>
                    Base A2: <span class="alert-color ${allerteDomani.A2}"></span> ${getColorText(allerteDomani.A2)}<br>
                    Base B: <span class="alert-color ${allerteDomani.B}"></span> ${getColorText(allerteDomani.B)}<br>
                    Base C: <span class="alert-color ${allerteDomani.C}"></span> ${getColorText(allerteDomani.C)}<br>
                    Base D: <span class="alert-color ${allerteDomani.D}"></span> ${getColorText(allerteDomani.D)}<br>
                    Base E1: <span class="alert-color ${allerteDomani.E1}"></span> ${getColorText(allerteDomani.E1)}<br>
                    Base E2: <span class="alert-color ${allerteDomani.E2}"></span> ${getColorText(allerteDomani.E2)}
                `;
                return;
            } else if (comuneSelezionato.endsWith("_base")) {
                const base = comuneSelezionato.split("_")[0];
                selectedLocationElement.textContent = `Base ${base}`;
                oggiAlertElement.innerHTML = `<span class="alert-color ${allerteOggi[base]}"></span> ${getColorText(allerteOggi[base])}`;
                domaniAlertElement.innerHTML = `<span class="alert-color ${allerteDomani[base]}"></span> ${getColorText(allerteDomani[base])}`;
                return;
            } else if (baseComune) {
                selectedLocationElement.textContent = comuneSelezionato.replace(/_A1|_A2|_B|_C|_D|_E1|_E2/g, '');
                oggiAlertElement.innerHTML = `<span class="alert-color ${allerteOggi[baseComune]}"></span> ${getColorText(allerteOggi[baseComune])}`;
                domaniAlertElement.innerHTML = `<span class="alert-color ${allerteDomani[baseComune]}"></span> ${getColorText(allerteDomani[baseComune])}`;
                return;
            } else {
                selectedLocationElement.textContent = "Comune non trovato";
                oggiAlertElement.textContent = "";
                domaniAlertElement.textContent = "";
            }
        }

        function getColorText(color) {
            switch (color) {
                case "verde":
                    return "Nessuna allerta specifica.";
                case "giallo":
                    return "Possibili criticità idrogeologiche localizzate.";
                case "arancione":
                    return "Possibili fenomeni intensi con criticità idrogeologica diffusa.";
                case "rosso":
                    return "Elevata criticità per rischio idrogeologico e idraulico.";
                default:
                    return "Nessuna informazione sull'allerta.";
            }
        }

        function caricaAllerte() {
            const oggi = new Date().toISOString().slice(0, 10);
            const domani = new Date(Date.now() + 86400000).toISOString().slice(0, 10); // Aggiungi un giorno in millisecondi

            db.collection("allerte").doc(oggi).get()
                .then((doc) => {
                    if (doc.exists) {
                        Object.assign(allerteOggi, doc.data().basi);
                        mostraAllerta();
                    } else {
                        console.log("Nessuna allerta per oggi.");
                    }
                })
                .catch((error) => {
                    console.error("Errore nel caricamento delle allerte di oggi:", error);
                });

            db.collection("allerte").doc(domani).get()
                .then((doc) => {
                    if (doc.exists) {
                        Object.assign(allerteDomani, doc.data().basi);
                        mostraAllerta();
                    } else {
                        console.log("Nessuna allerta per domani.");
                    }
                })
                .catch((error) => {
                    console.error("Errore nel caricamento delle allerte di domani:", error);
                });
        }

        // Inizializza il caricamento delle allerte all'avvio della pagina
        caricaAllerte();

        document.getElementById("comune").addEventListener("change", mostraAllerta);
    </script>

</body>
</html>
